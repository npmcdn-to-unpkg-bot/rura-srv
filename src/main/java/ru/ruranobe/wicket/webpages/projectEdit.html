<!DOCTYPE html>
<html xmlns:wicket="http://wicket.apache.org" lang="en">
<body>
<wicket:extend>
    <div class="container">
        <div class="leftColumn">
            <main class="content">
                <form wicket:id="projectInfoForm" class="FormUpdate FormAjax" data-type="project">
                    <h2>Редактирование проекта (серии)</h2>
                    <h3>Информация</h3>
                    <div class="form-group">
                        <label wicket:for="url">Ссылка</label>
                        <input type="text" class="form-control" wicket:id="url" name="url">
                    </div>
                    <div class="form-group">
                        <label for="banner">Изображение</label>
                        <input type="hidden" id="banner_id">
                        <img src="http://ruranobe.ru/w/images/6/6b/sidebanner-aw.png" height="73" width="220" id="banner">
                    </div>
                    <div class="progress collapse">
                        <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                            <span class="sr-only">0% Complete</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label wicket:for="title">Название для заголовков</label>
                        <input type="text" class="form-control" wicket:id="title" name="name_title">
                    </div>
                    <div class="form-group">
                        <label wicket:for="nameJp">Название (яп.)</label>
                        <input type="text" class="form-control" wicket:id="nameJp" name="name_jp">
                    </div>
                    <div class="form-group">
                        <label wicket:for="nameEn">Название (англ.)</label>
                        <input type="text" class="form-control" wicket:id="nameEn" name="name_en">
                    </div>
                    <div class="form-group">
                        <label wicket:for="nameRu">Название (рус.)</label>
                        <input type="text" class="form-control" wicket:id="nameRu" name="name_ru">
                    </div>
                    <div class="form-group">
                        <label wicket:for="nameRomaji">Название (романдзи)</label>
                        <input type="text" class="form-control" wicket:id="nameRomaji" name="name_romaji">
                    </div>
                    <div class="form-group">
                        <label wicket:for="author">Автор</label>
                        <div id="author-name-typeahead">
                            <input class="form-control typeahead author-name" type="text" wicket:id="author" name="author">
                        </div>
                    </div>
                    <div class="form-group">
                        <label wicket:for="illustrator">Иллюстратор</label>
                        <div id="illustrator-name-typeahead">
                            <input class="form-control typeahead illustrator-name" type="text" wicket:id="illustrator" name="illustrator">
                        </div>
                    </div>
                    <div class="form-group">
                        <input type="checkbox" wicket:id="onevolume" name="onevolume" value="false">
                        <label wicket:for="onevolume">Однотомник</label>
                    </div>
                    <div class="form-group">
                        <input type="checkbox" wicket:id="bannerHidden" name="banner_hidden" value="false">
                        <label wicket:for="bannerHidden">Баннер скрыт</label>
                    </div>
                    <div class="form-group">
                        <input type="checkbox" wicket:id="projectHidden" name="project_hidden" value="false">
                        <label wicket:for="projectHidden">Проект скрыт</label>
                    </div>
                    <div class="form-group">
                        <label wicket:for="franchise">Описание франшизы</label>
                        <textarea class="form-control" wicket:id="franchise" name="franchise" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label wicket:for="annotation">Аннотация</label>
                        <textarea class="form-control" wicket:id="annotation" name="annotation" rows="3"></textarea>
                    </div>
                    <span wicket:id="updateProjectAjaxFeedback"/>
                    <button wicket:id="updateProjectAjax" type="button" class="btn btn-primary btn-lg"></button>
                </form>

                <h3>Редактирование томов</h3>
                <div class="volumetable">
                    <form wicket:id="volumesForm">
                        <div class="btn-group col-12-sm" role="group" aria-label="Панель глав">
                            <button wicket:id="addVolume" type="button" class="btn btn-success" data-type="volume" title="Добавить новый том" id="btn-update-add"><i class="fa fa-plus"></i></button>
                            <button wicket:id="cloneVolume" type="button" class="btn btn-warning" title="Дублировать главу" id="btn-update-clone"><i class="fa fa-files-o"></i></button>
                            <button wicket:id="deleteVolume" type="button" class="btn btn-danger" data-type="volume" title="Удалить главу" id="btn-update-delete"><i class="fa fa-trash-o"></i></button>
                            <div class="btn-group">
                                <button data-toggle="dropdown" class="btn btn-primary dropdown-toggle">Выбранные колонки <span class="caret"></span></button>
                                <ul class="dropdown-menu noclose bullet pull-top pull-right">
                                    <!--li>
                                        <input type="checkbox" id="LABELnumber" name="LABEL" value="0">
                                        <label for="LABELnumber">#</label>
                                    </li-->
                                    <li>
                                        <input type="checkbox" id="LABELurl" name="LABEL" value="1" checked>
                                        <label for="LABELurl">Ссылка</label>
                                    </li>
                                    <li>
                                        <input type="checkbox" id="LABELname_file" name="LABEL" value="2" checked>
                                        <label for="LABELname_file">Имя для файлов (Основное имя)</label>
                                    </li>
                                    <li>
                                        <input type="checkbox" id="LABELname_title" name="LABEL" value="3" checked>
                                        <label for="LABELname_title">Имя для заголовков</label>
                                    </li>
                                    <li>
                                        <input type="checkbox" id="LABELname_jp" name="LABEL" value="4" checked>
                                        <label for="LABELname_jp">Название (яп.)</label>
                                    </li>
                                    <li>
                                        <input type="checkbox" id="LABELname_en" name="LABEL" value="5" checked>
                                        <label for="LABELname_en">Название (англ.)</label>
                                    </li>
                                    <li>
                                        <input type="checkbox" id="LABELname_ru" name="LABEL" value="6" checked>
                                        <label for="LABELname_ru">Название (рус.)</label>
                                    </li>
                                    <li>
                                        <input type="checkbox" id="LABELname_romaji" name="LABEL" value="7" checked>
                                        <label for="LABELname_romaji">Название (романдзи)</label>
                                    </li>
                                    <li>
                                        <input type="checkbox" id="LABELname_short" name="LABEL" value="8" checked>
                                        <label for="LABELname_short">Короткое название</label>
                                    </li>
                                    <!--li>
                                        <input type="checkbox" id="LABELproject_id" name="LABEL" value="9">
                                        <label for="LABELproject_id">Серия</label>
                                    </li-->
                                    <li>
                                        <input type="checkbox" id="LABELsequence_number" name="LABEL" value="10" checked>
                                        <label for="LABELsequence_number">Номер в серии</label>
                                    </li>
                                    <li>
                                        <input type="checkbox" id="LABELauthor" name="LABEL" value="11">
                                        <label for="LABELauthor">Автор</label>
                                    </li>
                                    <li>
                                        <input type="checkbox" id="LABELillustrator" name="LABEL" value="12">
                                        <label for="LABELillustrator">Иллюстратор</label>
                                    </li>
                                    <li>
                                        <input type="checkbox" id="LABELrelease_date" name="LABEL" value="13" checked>
                                        <label for="LABELrelease_date">Дата публикации</label>
                                    </li>
                                    <li>
                                        <input type="checkbox" id="LABELISBN" name="LABEL" value="14" checked>
                                        <label for="LABELISBN">ISBN</label>
                                    </li>
                                    <li>
                                        <input type="checkbox" id="LABELvolume_type" name="LABEL" value="15">
                                        <label for="LABELvolume_type">Тип релиза</label>
                                    </li>
                                    <li>
                                        <input type="checkbox" id="LABELvolume_status" name="LABEL" value="16">
                                        <label for="LABELvolume_status">Cтатус релиза</label>
                                    </li>
                                    <!--li>
                                        <input type="checkbox" id="LABELexternal_url" name="LABEL" value="17">
                                        <label for="LABELexternal_url">Внешняя ссылка</label>
                                    </li-->
                                    <li>
                                        <input type="checkbox" id="LABELannotation" name="LABEL" value="18">
                                        <label for="LABELannotation">Аннотация</label>
                                    </li>
                                    <li>
                                        <input type="checkbox" id="LABELadult" name="LABEL" value="19">
                                        <label for="LABELadult">18+ (Непотребное содержание)</label>
                                    </li>
                                    <!-- Other items -->
                                </ul>
                            </div>
                        </div>
                        <div class="col-12-sm" style="overflow-x:scroll;margin-top:15px;">
                            <table class="table table-bordered table-condensed">
                                <thead>
                                <tr>
                                    <!--th>#</th-->
                                    <th>Ссылка</th>
                                    <th>Имя для файлов (Основное имя)</th>
                                    <th>Имя для заголовков</th>
                                    <th>Название (яп.)</th>
                                    <th>Название (англ.)</th>
                                    <th>Название (рус.)</th>
                                    <th>Название (романдзи)</th>
                                    <th>Короткое название</th>
                                    <!--th>Серия</th-->
                                    <th>Номер в серии</th>
                                    <th>Автор</th>
                                    <th>Иллюстратор</th>
                                    <th>Дата публикации</th>
                                    <th>ISBN</th>
                                    <th>Тип релиза</th>
                                    <th>Статус релиза</th>
                                    <!--th>Внешняя ссылка</th-->
                                    <th>Аннотация</th>
                                    <th>18+ (Непотребное содержание)</th>
                                </tr>
                                </thead>
                                <tbody>
                                    <wicket:container wicket:id="volumeRepeater">
                                        <tr class="FormAjax FormUpdate" data-parent="#volume" data-type="volume_n1">
                                            <!--input type="hidden" id="volume_id" name="volume_id"-->
                                            <td>
                                                <label name="volOrderNumber" wicket:id="volOrderNumber"></label>
                                            </td>
                                            <td>
                                                <input type="text" class="form-control" placeholder="<пусто>" wicket:id="volUrl" name="url" value="http://ruranobe.ru/r/sao/v1">
                                            </td>
                                            <td>
                                                <input type="text" class="form-control" placeholder="<пусто>" wicket:id="volNameFile" name="name_file" value="Sword Art Online 1">
                                            </td>
                                            <td>
                                                <input type="text" class="form-control" placeholder="<пусто>" wicket:id="volTitle" name="name_title" value="Sword Art Online 1">
                                            </td>
                                            <td>
                                                <input type="text" class="form-control" placeholder="<пусто>" wicket:id="volNameJp" name="name_jp" value="ソードアート・オンライン1 アインクラッド">
                                            </td>
                                            <td>
                                                <input type="text" class="form-control" placeholder="<пусто>" wicket:id="volNameEn" name="name_en" value="Sword Art Online 1: Aincrad">
                                            </td>
                                            <td>
                                                <input type="text" class="form-control" placeholder="<пусто>" wicket:id="volNameRu" name="name_ru" value="Sword Art Online 1: Айнкрад">
                                            </td>
                                            <td>
                                                <input type="text" class="form-control" placeholder="<пусто>" wicket:id="volNameRomaji" name="name_romaji">
                                            </td>
                                            <td>
                                                <input type="text" class="form-control" placeholder="<пусто>" wicket:id="volNameShort" name="name_short">
                                            </td>
                                            <!--td>
                                                <select class="form-control" wicket:id="1project_id" name="project_id">
                                                    <option>Sword Art Online</option>
                                                    <option>2</option>
                                                    <option>3</option>
                                                    <option>4</option>
                                                    <option>5</option>
                                                </select>
                                            </td-->
                                            <td>
                                                <input type="text" class="form-control" placeholder="<пусто>" wicket:id="volSequenceNumber" name="sequence_number">
                                            </td>
                                            <td>
                                                <input class="form-control typeahead author-name" type="text" placeholder="<пусто>" wicket:id="volAuthor" name="author" value="Рэки Кавахара">
                                            </td>
                                            <td>
                                                <input class="form-control typeahead illustrator-name" type="text" placeholder="<пусто>" wicket:id="volIllustrator" name="illustrator" value="abec">
                                            </td>
                                            <td>
                                                <input type="text" class="form-control" placeholder="<пусто>" wicket:id="volReleaseDate" name="release_date">
                                            </td>
                                            <td>
                                                <input type="text" class="form-control" placeholder="<пусто>" wicket:id="volIsbn" name="ISBN" value="978-4048677608">
                                            </td>
                                            <td>
                                                <select class="form-control" wicket:id="volumeType" name="volume_type"></select>
                                            </td>
                                            <td>
                                                <select class="form-control" wicket:id="volumeStatus" name="volume_status">
                                                    <option value="1">Скрыт</option>
                                                    <optgroup label="Сторонний перевод">
                                                        <option value="3">Заброшенный сторонний перевод</option>
                                                        <option value="4">Активный сторонний перевод</option>
                                                        <option value="5">Завершенный сторонний перевод</option>
                                                    </optgroup>
                                                    <optgroup label="Не в работе">
                                                        <option value="6">Отсутствует анлейт</option>
                                                        <option value="7">Заморожен</option>
                                                        <option value="8">Приостановлен</option>
                                                        <option value="9">Очередь перевода</option>
                                                    </optgroup>
                                                    <optgroup label="В работе">
                                                        <option value="10">Перевод в онгоинге</option>
                                                        <option value="11">Перевод</option>
                                                        <option value="12">Редактура</option>
                                                    </optgroup>
                                                    <optgroup label="Опубликован">
                                                        <option value="13">Не оформлен</option>
                                                        <option value="14">Завершен</option>
                                                    </optgroup>
                                                </select>
                                            </td>
                                            <!--td>
                                                <input type="text" class="form-control" placeholder="<пусто>" wicket:id="1external_url" name="external_url">
                                            </td-->
                                            <td>
                                                <textarea class="form-control" placeholder="<пусто>" wicket:id="volAnnotation" name="annotation" rows="3" style="width: 100%;"></textarea>
                                            </td>
                                            <td>
                                                <input type="checkbox" class="form-control" placeholder="<пусто>" wicket:id="volAdult" name="adult">
                                            </td>
                                        </tr>
                                    </wicket:container>
                                </tbody>
                            </table>
                        </div>
                        <span wicket:id="updateVolumesAjaxFeedback"/>
                        <button wicket:id="updateVolumesAjax" type="button" class="btn btn-primary btn-lg"></button>
                    </form>
                </div>

                <h3>Редактирование подсерий</h3>
                <form wicket:id="subProjectForm">
                    <div class="subseriestable">
                        <div class="btn-group col-12-sm">
                            <button type="button" class="btn btn-success" data-type="subseries" title="Добавить новую подсерию" id="btn-sub-add"><i class="fa fa-plus"></i></button>
                            <button type="button" class="btn btn-danger" data-type="subseries" title="Удалить подсерию" id="btn-sub-delete"><i class="fa fa-trash-o"></i></button>
                        </div>
                        <div class="list-group select sortable" id="subseries" style="margin-top:15px;">
                            <wicket:container wicket:id="subProjectRepeater">
                                <a data-toggle="collapse" data-parent="#subseries" data-type="subseries_n" aria-expanded="true" class="list-group-item FormAjax FormUpdate" >
                                    <i class="fa fa-ellipsis-v move"></i>
                                    <input wicket:id="subProjectId" type="hidden" name="subProjectId">
                                    <input wicket:id="subProjectName" type="text" class="form-control" placeholder="<пусто>" name="subProjectTitle">
                                </a>
                            </wicket:container>
                        </div>
                        <button type="button" id="updateSubProjects" class="btn btn-primary btn-lg"/>
                    </div>

                    <script type="text/javascript">

                        $('#btn-sub-add').click(function(){
                            var newSub = '<a data-toggle="collapse" data-parent="#subseries" data-type="subseries_n" aria-expanded="true" class="list-group-item FormAjax FormUpdate" >';
                            newSub +=  '<i class="fa fa-ellipsis-v move"></i>'
                            newSub +=  '<input type="text" class="form-control" placeholder="<пусто>" >'
                            newSub +=  '</a>';
                            if($('.subseriestable a.list-group-item').hasClass('active')){
                                $(newSub).insertAfter($(".subseriestable a.list-group-item.active"));
                            } else {
                                $(newSub).appendTo($("#subseries"));
                            }
                        });

                        $('#btn-sub-delete').click(function(){
                            if($('.subseriestable a.list-group-item').hasClass('active')){
                                var type = $(this).data('type');
                                var Needdelete = $('[data-parent="#'+type+'"].info')
                                $thissub = $('.subseriestable a.list-group-item.active');
                                if($thissub.index() == $('.subseriestable a.list-group-item:last').index()){
                                    $nextsub = $thissub.prev('a.list-group-item');
                                } else {
                                    $nextsub = $thissub.next('a.list-group-item');
                                }
                                $thissub.remove();
                                $nextsub.addClass('active');
                                $nextsub.children('input').focus();
                            }
                            else {
                                alert('Сначала выделите подсерию!')
                            }
                        });

                        $('#updateSubProjects').click(
                                function()
                                {
                                    var subProjects = [];
                                    $.map($('#subseries').find('a'), function(el)
                                    {
                                        subProjects.push(
                                                {projectId:$(el).children('input[type=hidden]').val(),
                                                    orderNumber:$(el).index()+1,
                                                    projectTitle:$(el).children('input[type=text]').val()}
                                        );
                                    });
                                    Wicket.Ajax.get({"u":callbackUrl2, "ep":{"subProjects":JSON.stringify(subProjects)}});
                                }
                        );


                        $('#subseries').sortable();

                        $('.volumetable').on('click','tr',function(){
                            $('.volumetable tr').removeClass('info');
                            $(this).addClass('info');
                            var tableOrderNumber = $(this).find('label[name=volOrderNumber]').text()
                            Wicket.Ajax.get({"u":callbackUrl1, "ep":{"tableOrderNumber":tableOrderNumber}});
                        });

                        $('#banner').fileupload({
                            url: callbackUrl3,
                            headers: {'Wicket-Ajax': true, 'Wicket-Ajax-BaseURL': 'a/sao?0', 'Accept': 'application/json'},
                            contentType: 'application/json',
                            dataType: 'json',
                            formData: {
                                id: $('#banner_id').val()
                            },
                            acceptFileTypes: /(\.|\/)(jpe?g|png)$/i,
                            previewMaxHeight: 73,
                            previewMaxWidth: 220,
                            maxNumberOfFiles: 1
                        }).on('fileuploadadd', function (e, data) {
                            $('#imageform .progress').collapse('show');
                            //$('#banner').attr('src','loading.gif');
                            data.submit();
                        }).on('fileuploadprocessalways', function (e, data) {
                            var index = data.index,
                                    file = data.files[index];
                            if (file.error) // выводим сообщение об ошибке обработки на клиенте
                                $('.progress').after('<div class="alert alert-danger alert-dismissible fade in" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Ошибка!</strong> '+file.error+'</div>');
                        }).on('fileuploadprogressall', function (e, data) { // обновляем прогресбар
                            var progress = parseInt(data.loaded / data.total * 100, 10);
                            $('.progress-bar').css('width', progress + '%');
                            $('.progress-bar').attr('aria-valuenow', progress);
                            $('.progress-bar span').text(progress + '% Complete');
                        }).on('fileuploaddone', function (e, data) { // при завершении загрузки заменяем превюшку на img тег с адресом уже загруженной ирасты
                            $('.progress').collapse('hide');
                            //console.log(data) // с сервера в json`е должны прийти поля url и id
                            $.each(data.result.files, function (index, file) {
                                if (file.url) {
                                    $('#banner_id').val(file.id);
                                    $('#banner').attr('src',file.url);
                                } else if (file.error) // выводим ошибку возвращенную с сервера
                                    $('.progress').after('<div class="alert alert-danger alert-dismissible fade in" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Ошибка!</strong> '+file.error+'</div>');
                            });
                        }).on('fileuploadfail', function (e, data) { // выводим ошибку аякса
                            $('.progress').after('<div class="alert alert-danger alert-dismissible fade in" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Ошибка!</strong> Загрузка не удалась</div>');
                        });
                    </script>

                </form>
            </main>
        </div>
    </div>


</wicket:extend>
</body>
</html>