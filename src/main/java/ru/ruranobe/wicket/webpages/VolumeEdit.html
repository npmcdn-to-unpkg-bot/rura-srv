<!DOCTYPE html>
<html xmlns:wicket="http://wicket.apache.org" lang="en">

<body data-spy="scroll" data-target=".scrollspy">

<wicket:extend>
    <div class="container">
        <div class="leftColumn">
            <main class="content">
                <h2>Редактирование тома</h2>
                <form wicket:id="volumeForm" class="admin-block">
                    <!--input type="hidden" id="volume_id" name="volume_id"-->
                    <div class="admin-header">
                        <span>Информация</span>
                        <div class="btn-group" role="group" aria-label="Панель">
                            <button wicket:id="updateVolumeAjax" type="button" class="btn btn-primary" title="Сохранить"><i class="fa fa-floppy-o"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label wicket:for="url">Ссылка</label>
                        <input wicket:id="url" type="text" class="form-control">
                    </div>
                    <div class="form-group">
                        <label wicket:for="nameFile">Имя для файлов (Основное имя)</label>
                        <input wicket:id="nameFile" type="text" class="form-control">
                    </div>
                    <div class="form-group">
                        <label wicket:for="nameTitle">Имя для заголовков</label>
                        <input wicket:id="nameTitle" type="text" class="form-control">
                    </div>
                    <div class="form-group">
                        <label wicket:for="nameJp">Название (яп.)</label>
                        <input wicket:id="nameJp" type="text" class="form-control">
                    </div>
                    <div class="form-group">
                        <label wicket:for="nameEn">Название (англ.)</label>
                        <input wicket:id="nameEn" type="text" class="form-control">
                    </div>
                    <div class="form-group">
                        <label wicket:for="nameRu">Название (рус.)</label>
                        <input wicket:id="nameRu" type="text" class="form-control">
                    </div>
                    <div class="form-group">
                        <label wicket:for="nameRomaji">Название (романдзи)</label>
                        <input wicket:id="nameRomaji" type="text" class="form-control">
                    </div>
                    <div class="form-group">
                        <label wicket:for="nameShort">Короткое название</label>
                        <input wicket:id="nameShort" type="text" class="form-control">
                    </div>
                    <div class="form-group">
                        <label wicket:for="projectId">Серия</label>
                        <select wicket:id="projectId" class="form-control">
                            <option>Sword Art Online</option>
                            <option>2</option>
                            <option>3</option>
                            <option>4</option>
                            <option>5</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label wicket:for="sequenceNumber">Номер в серии</label>
                        <input wicket:id="sequenceNumber" type="text" class="form-control">
                    </div>
                    <div class="form-group">
                        <label wicket:for="author">Автор</label>
                        <div id="author-name-typeahead">
                            <input wicket:id="author" class="form-control typeahead author-name" type="text">
                        </div>
                    </div>
                    <div class="form-group">
                        <label wicket:for="illustrator">Иллюстратор</label>
                        <div id="illustrator-name-typeahead">
                            <input wicket:id="illustrator" class="form-control typeahead illustrator-name" type="text">
                        </div>
                    </div>
                    <div class="form-group">
                        <label wicket:for="releaseDate">Дата публикации</label>
                        <input wicket:id="releaseDate" type="text" class="form-control">
                    </div>
                    <div class="form-group">
                        <label wicket:for="isbn">ISBN</label>
                        <input wicket:id="isbn" type="text" class="form-control">
                    </div>
                    <div class="form-group">
                        <label wicket:for="volumeType">Тип релиза</label>
                        <select wicket:id="volumeType" class="form-control">
                            <option>Ранобэ</option>
                            <option>Побочные истории</option>
                            <option>Авторские додзинси</option>
                            <option>Другое</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label wicket:for="volumeStatus">Статус релиза</label>
                        <select class="form-control" wicket:id="volumeStatus">
                            <option value="1">Скрыт</option>
                            <optgroup label="Сторонний перевод">
                                <option value="3">Заброшенный сторонний перевод</option>
                                <option value="4">Активный сторонний перевод</option>
                                <option value="5">Завершенный сторонний перевод</option>
                            </optgroup>
                            <optgroup label="Не в работе">
                                <option value="6">Отсутствует анлейт</option>
                                <option value="7">Заморожен</option>
                                <option value="8">Приостановлен</option>
                                <option value="9">Очередь перевода</option>
                            </optgroup>
                            <optgroup label="В работе">
                                <option value="10">Перевод в онгоинге</option>
                                <option value="11">Перевод</option>
                                <option value="12">Редактура</option>
                            </optgroup>
                            <optgroup label="Опубликован">
                                <option value="13">Не оформлен</option>
                                <option value="14">Завершен</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="form-group">
                        <label wicket:for="externalUrl">Внешняя ссылка</label>
                        <input wicket:id="externalUrl" type="text" class="form-control">
                    </div>
                    <div class="form-group">
                        <label wicket:for="annotation">Аннотация</label>
                        <textarea wicket:id="annotation" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-group checkbox">
                        <label>
                            <input wicket:id="adult" type="checkbox" class="form-control"> &emsp;18+ (Непотребное содержание)
                        </label>
                    </div>
                    <div id="testdibv"></div>
                </form>


                <form class="admin-block" id="stuffHead">
                    <div class="admin-header">
                        <span>Этапы/Стаф</span>
                        <div class="btn-group" role="group" aria-label="Панель участника">
                            <button type="button" class="btn btn-success" title="Добавить нового участника" id="btn-participant-add"><i class="fa fa-plus"></i>
                            </button>
                            <button type="button" class="btn btn-danger" title="Удалить участника" id="btn-participant-delete" disabled><i class="fa fa-trash-o"></i>
                            </button>
                            <button type="button" class="btn btn-primary" title="Сохранить"><i class="fa fa-floppy-o"></i>
                            </button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-4">
                            <div class="list-group select sortable" id="participantselect">
                                <a data-toggle="collapse" data-parent="#participantform" href="#participant1" aria-expanded="true" aria-controls="participant1" class="list-group-item">
                                    <i class="fa fa-ellipsis-v move"></i>
                                    <span class="hidden-sm hidden-xs" id="participant1_name">Ushwood</span> - <span class="hidden-sm hidden-xs" id="participant1_role">Перевод с английского</span>
                                </a>
                                <a data-toggle="collapse" data-parent="#participantform" href="#participant2" aria-expanded="true" aria-controls="participant2" class="list-group-item">
                                    <i class="fa fa-ellipsis-v move"></i>
                                    <span class="hidden-sm hidden-xs" id="participant2_name">Danholm</span> - <span class="hidden-sm hidden-xs" id="participant2_role">Эдит</span>
                                </a>
                                <a data-toggle="collapse" data-parent="#participantform" href="#participant3" aria-expanded="true" aria-controls="participant3" class="list-group-item">
                                    <i class="fa fa-ellipsis-v move"></i>
                                    <span class="hidden-sm hidden-xs" id="participant3_name">Lady Astrel</span> - <span class="hidden-sm hidden-xs" id="participant3_role">Редактура</span>
                                </a>
                                <a data-toggle="collapse" data-parent="#participantform" href="#participant4" aria-expanded="true" aria-controls="participant4" class="list-group-item">
                                    <i class="fa fa-ellipsis-v move"></i>
                                    <span class="hidden-sm hidden-xs" id="participant4_name">Test</span> - <span class="hidden-sm hidden-xs" id="participant4_role">Test</span>
                                </a>
                            </div>
                        </div>
                        <div class="col-xs-8 admin-affix" id="participantform" role="tablist" aria-multiselectable="true">
                            <div class="progress collapse">
                                <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                    <span class="sr-only">0% Complete</span>
                                </div>
                            </div>
                            <div class="panel">
                                <div class="row collapse participant-data" role="tabpanel" id="participant1">
                                    <input type="hidden" id="participant1_id">
                                    <input type="hidden" id="participant1_order">
                                    <input type="hidden" id="participant1_delete">
                                    <div class="participant-data-main">
                                        <h3>Настройка участника</h3>
                                        <div class="form-group">
                                            <label for="participant1_name">Участник</label>
                                            <div id="participant1_names_selector">
                                                <input class="form-control typeahead name-input" type="text" id="participant1_name_input" value="Ushwood">
                                            </div>
                                            <label for="participant1_role">Роль</label>
                                            <select class="form-control role-input" id="participant_roles_selector">
                                                <option selected>Перевод с английского</option>
                                                <option>Эдит</option>
                                                <option>Редактура</option>
                                                <option>Test</option>
                                            </select>
                                            <div class="form-group checkbox">
                                                <label>
                                                    <input type="checkbox" class="form-control" id="participant1_team_show" name="participant1_team_show"> &emsp;Отображать команду
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel">
                                <div class="row collapse participant-data" role="tabpanel" id="participant2">
                                    <input type="hidden" id="participant2_id">
                                    <input type="hidden" id="participant2_order">
                                    <input type="hidden" id="participant2_delete">
                                    <div class="participant-data-main">
                                        <h3>Настройка участника</h3>
                                        <div class="form-group">
                                            <label for="participant1_name">Участник</label>
                                            <div id="participant2_names_selector">
                                                <input class="form-control typeahead name-input" type="text" id="participant2_name_input" value="Danholm">
                                            </div>
                                            <label for="participant1_role">Роль</label>
                                            <select class="form-control role-input" id="participant_roles_selector">
                                                <option>Перевод с английского</option>
                                                <option selected>Эдит</option>
                                                <option>Редактура</option>
                                                <option>Test</option>
                                            </select>
                                            <div class="form-group checkbox">
                                                <label>
                                                    <input type="checkbox" class="form-control" id="participant2_team_show" name="participant2_team_show"> &emsp;Отображать команду
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel">
                                <div class="row collapse participant-data" role="tabpanel" id="participant3">
                                    <input type="hidden" id="participant3_id" value="3">
                                    <input type="hidden" id="participant3_order">
                                    <input type="hidden" id="participant3_delete">
                                    <div class="participant-data-main">
                                        <h3>Настройка участника</h3>
                                        <div class="form-group">
                                            <label for="participant1_name">Участник</label>
                                            <div id="participant3_names_selector">
                                                <input class="form-control typeahead name-input" type="text" id="participant3_name_input" value="Lady Astrel">
                                            </div>
                                            <label for="participant1_role">Роль</label>
                                            <select class="form-control role-input" id="participant_roles_selector">
                                                <option>Перевод с английского</option>
                                                <option>Эдит</option>
                                                <option selected>Редактура</option>
                                                <option>Test</option>
                                            </select>
                                            <div class="form-group checkbox">
                                                <label>
                                                    <input type="checkbox" class="form-control" id="participant3_team_show" name="participant3_team_show"> &emsp;Отображать команду
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel">
                                <div class="row collapse participant-data" role="tabpanel" id="participant4">
                                    <input type="hidden" id="participant4_id">
                                    <input type="hidden" id="participant4_order">
                                    <input type="hidden" id="participant4_delete">
                                    <div class="participant-data-main">
                                        <h3>Настройка участника</h3>
                                        <div class="form-group">
                                            <label for="participant1_name">Участник</label>
                                            <div id="participant4_names_selector">
                                                <input class="form-control typeahead name-input" type="text" id="participant4_name_input" value="Test">
                                            </div>
                                            <label for="participant1_role">Роль</label>
                                            <select class="form-control role-input" id="participant_roles_selector">
                                                <option>Перевод с английского</option>
                                                <option>Эдит</option>
                                                <option>Редактура</option>
                                                <option selected>Test</option>
                                            </select>
                                            <div class="form-group checkbox">
                                                <label>
                                                    <input type="checkbox" class="form-control" id="participant4_team_show" name="participant4_team_show"> &emsp;Отображать команду
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>


                <form class="admin-block" id="volumeHead">
                    <div class="admin-header">
                        <span>Главы</span>
                        <div class="btn-group" role="group" aria-label="Панель глав">
                            <button type="button" class="btn btn-success" title="Добавить новую главу" id="btn-chapter-add"><i class="fa fa-plus"></i>
                            </button>
                            <button type="button" class="btn btn-danger" title="Удалить главу" id="btn-chapter-delete" disabled><i class="fa fa-trash-o"></i>
                            </button>
                            <button type="button" class="btn btn-primary" title="Сохранить"><i class="fa fa-floppy-o"></i>
                            </button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-4">
                            <div class="list-group select sortable" id="chapterselect">
                                <a data-toggle="collapse" data-parent="#chapterform" href="#chapter1" aria-expanded="true" aria-controls="chapter1" class="list-group-item">
                                    <i class="fa fa-ellipsis-v move"></i>
                                    <span class="hidden-sm hidden-xs" id="chapter1_name">Начальные иллюстрации</span>
                                </a>
                                <a data-toggle="collapse" data-parent="#chapterform" href="#chapter2" aria-expanded="true" aria-controls="chapter2" class="list-group-item">
                                    <i class="fa fa-ellipsis-v move"></i>
                                    <span class="hidden-sm hidden-xs" id="chapter2_name">Пролог</span>
                                </a>
                                <a data-toggle="collapse" data-parent="#chapterform" href="#chapter3" aria-expanded="true" aria-controls="chapter3" class="list-group-item">
                                    <i class="fa fa-ellipsis-v move"></i>
                                    <span class="hidden-sm hidden-xs" id="chapter3_name">Глава 1</span>
                                </a>
                                <a data-toggle="collapse" data-parent="#chapterform" href="#chapter4" aria-expanded="true" aria-controls="chapter4" class="list-group-item">
                                    <i class="fa fa-ellipsis-v move"></i>
                                    <span class="hidden-sm hidden-xs" id="chapter4_name">Глава 2</span>
                                </a>
                            </div>
                        </div>
                        <div class="col-xs-8 admin-affix" id="chapterform" role="tablist" aria-multiselectable="true">
                            &nbsp;
                            <div class="progress collapse">
                                <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                    <span class="sr-only">0% Complete</span>
                                </div>
                            </div>
                            <div class="panel">
                                <div class="row collapse chapter-data" role="tabpanel" id="chapter1">
                                    <input type="hidden" id="chapter1_id">
                                    <input type="hidden" id="chapter1_order">
                                    <input type="hidden" id="chapter1_delete">
                                    <div class="chapter-data-main">
                                        <h3>Настройка главы</h3>
                                        <div class="form-group checkbox">
                                            <label>
                                                <input type="checkbox" class="form-control is-subchapter" id="chapter1_is_subchapter" name="chapter1_is_subchapter"> &emsp;Подглава
                                            </label>
                                        </div>
                                        <div class="form-group">
                                            <label for="chapter1_url">Ссылка</label>
                                            <input class="form-control url-input" type="text" id="chapter1_url_input">
                                            <label for="chapter1_name">Заголовок</label>
                                            <input class="form-control name-input" type="text" id="chapter1_name_input" value="Начальные иллюстрации">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel">
                                <div class="row collapse chapter-data" role="tabpanel" id="chapter2">
                                    <input type="hidden" id="chapter2_id">
                                    <input type="hidden" id="chapter2_order">
                                    <input type="hidden" id="chapter2_delete">
                                    <div class="chapter-data-main">
                                        <h3>Настройка главы</h3>
                                        <div class="form-group checkbox">
                                            <label>
                                                <input type="checkbox" class="form-control is-subchapter" id="chapter2_is_subchapter" name="chapter2_is_subchapter"> &emsp;Подглава
                                            </label>
                                        </div>
                                        <div class="form-group">
                                            <label for="chapter2_url">Ссылка</label>
                                            <input class="form-control url-input" type="text" id="chapter2_url_input">
                                            <label for="chapter2_name">Заголовок</label>
                                            <input class="form-control name-input" type="text" id="chapter2_name_input" value="Пролог">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel">
                                <div class="row collapse chapter-data" role="tabpanel" id="chapter3">
                                    <input type="hidden" id="chapter3_id">
                                    <input type="hidden" id="chapter3_order">
                                    <input type="hidden" id="chapter3_delete">
                                    <div class="chapter-data-main">
                                        <h3>Настройка главы</h3>
                                        <div class="form-group checkbox">
                                            <label>
                                                <input type="checkbox" class="form-control is-subchapter" id="chapter3_is_subchapter" name="chapter3_is_subchapter"> &emsp;Подглава
                                            </label>
                                        </div>
                                        <div class="form-group">
                                            <label for="chapter3_url">Ссылка</label>
                                            <input class="form-control url-input" type="text" id="chapter3_url_input">
                                            <label for="chapter3_name">Заголовок</label>
                                            <input class="form-control name-input" type="text" id="chapter3_name_input" value="Глава 1">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel">
                                <div class="row collapse chapter-data" role="tabpanel" id="chapter4">
                                    <input type="hidden" id="chapter4_id">
                                    <input type="hidden" id="chapter4_order">
                                    <input type="hidden" id="chapter4_delete">
                                    <div class="chapter-data-main">
                                        <h3>Настройка главы</h3>
                                        <div class="form-group checkbox">
                                            <label>
                                                <input type="checkbox" class="form-control is-subchapter" id="chapter4_is_subchapter" name="chapter4_is_subchapter"> &emsp;Подглава
                                            </label>
                                        </div>
                                        <div class="form-group">
                                            <label for="chapter4_url">Ссылка</label>
                                            <input class="form-control url-input" type="text" id="chapter4_url_input">
                                            <label for="chapter4_name">Заголовок</label>
                                            <input class="form-control name-input" type="text" id="chapter4_name_input" value="Глава 2">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>


                <form class="admin-block" id="updateHead">
                    <div class="admin-header">
                        <span>Обновления</span>
                        <div class="btn-group" role="group" aria-label="Панель глав">
                            <button type="button" class="btn btn-success" title="Добавить новую главу" id="btn-update-add"><i class="fa fa-plus"></i>
                            </button>
                            <button type="button" class="btn btn-danger" title="Удалить главу" id="btn-update-delete" disabled><i class="fa fa-trash-o"></i>
                            </button>
                            <button type="button" class="btn btn-primary" title="Сохранить"><i class="fa fa-floppy-o"></i>
                            </button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-4">
                            <div class="list-group select sortable" id="updateselect">
                                <a data-toggle="collapse" data-parent="#updateform" href="#update1" aria-expanded="true" aria-controls="update1" class="list-group-item">
                                    <span class="hidden-sm hidden-xs" id="update1_date">2015-05-01 03-12</span>: <span class="hidden-sm hidden-xs" id="update1_chapter">Весь том</span>
                                </a>
                                <a data-toggle="collapse" data-parent="#updateform" href="#update2" aria-expanded="true" aria-controls="update2" class="list-group-item">
                                    <span class="hidden-sm hidden-xs" id="update2_date">2013-01-01 05-02</span>: <span class="hidden-sm hidden-xs" id="update2_chapter">Начальные иллюстрации (1)</span>
                                </a>
                                <a data-toggle="collapse" data-parent="#updateform" href="#update3" aria-expanded="true" aria-controls="update3" class="list-group-item">
                                    <span class="hidden-sm hidden-xs" id="update3_date">2074-12-13 15-35</span>: <span class="hidden-sm hidden-xs" id="update3_chapter">Пролог (2)</span>
                                </a>
                                <a data-toggle="collapse" data-parent="#updateform" href="#update4" aria-expanded="true" aria-controls="update4" class="list-group-item">
                                    <span class="hidden-sm hidden-xs" id="update4_date">2015-05-01 23-25</span>: <span class="hidden-sm hidden-xs" id="update4_chapter">Глава 1 (3)</span>
                                </a>
                            </div>
                        </div>
                        <div class="col-xs-8 admin-affix" id="updateform" role="tablist" aria-multiselectable="true">
                            &nbsp;
                            <div class="progress collapse update-insert">
                                <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                    <span class="sr-only">0% Complete</span>
                                </div>
                            </div>
                            <div class="panel">
                                <div class="row collapse update-data" role="tabpanel" id="update1">
                                    <input type="hidden" id="update1_id">
                                    <input type="hidden" id="update1_order">
                                    <input type="hidden" id="update1_delete">
                                    <div class="update-data-main">
                                        <h3>Настройка обновления</h3>
                                        <div class="form-group">
                                            <label for="update1_type">Тип</label>
                                            <select id="update1_type" class="form-control update_type">
                                                <option>Перевод</option>
                                                <option>Глобальная редактура</option>
                                                <option>Обновление иллюстраций</option>
                                                <option>Другое</option>
                                            </select>
                                            <label for="update1_chapter">Глава</label>
                                            <select id="update1_chapter_select" class="form-control update_chapter">
                                            </select>
                                            <label for="update1_date_input">Дата</label>
                                            <input class="form-control date-input" type="text" id="update1_date_input" value="2015-05-01 03-12">
                                            <label for="update1_name">Описание (опционально)</label>
                                            <input class="form-control" type="text" id="update1_description" placeholder="Перевод">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel">
                                <div class="row collapse update-data" role="tabpanel" id="update2">
                                    <input type="hidden" id="update2_id">
                                    <input type="hidden" id="update2_order">
                                    <input type="hidden" id="update2_delete">
                                    <div class="update-data-main">
                                        <h3>Настройка обновления</h3>
                                        <div class="form-group">
                                            <label for="update2_type">Тип</label>
                                            <select id="update2_type" class="form-control update_type">
                                                <option>Перевод</option>
                                                <option>Глобальная редактура</option>
                                                <option>Обновление иллюстраций</option>
                                                <option>Другое</option>
                                            </select>
                                            <label for="update2_chapter">Глава</label>
                                            <select id="update2_chapter_select" class="form-control update_chapter">
                                            </select>
                                            <label for="update2_date_input">Дата</label>
                                            <input class="form-control date-input" type="text" id="update2_date_input" value="2013-01-01 05-02">
                                            <label for="update2_name">Описание (опционально)</label>
                                            <input class="form-control" type="text" id="update2_description" placeholder="Перевод">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel">
                                <div class="row collapse update-data" role="tabpanel" id="update3">
                                    <input type="hidden" id="update3_id">
                                    <input type="hidden" id="update3_order">
                                    <input type="hidden" id="update3_delete">
                                    <div class="update-data-main">
                                        <h3>Настройка обновления</h3>
                                        <div class="form-group">
                                            <label for="update3_type">Тип</label>
                                            <select id="update3_type" class="form-control update_type">
                                                <option>Перевод</option>
                                                <option>Глобальная редактура</option>
                                                <option>Обновление иллюстраций</option>
                                                <option>Другое</option>
                                            </select>
                                            <label for="update3_chapter">Глава</label>
                                            <select id="update3_chapter_select" class="form-control update_chapter">
                                            </select>
                                            <label for="update3_date_input">Дата</label>
                                            <input class="form-control date-input" type="text" id="update3_date_input" value="2074-12-13 15-35">
                                            <label for="update3_name">Описание (опционально)</label>
                                            <input class="form-control" type="text" id="update3_description" placeholder="Перевод">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel">
                                <div class="row collapse update-data" role="tabpanel" id="update4">
                                    <input type="hidden" id="update4_id">
                                    <input type="hidden" id="update4_order">
                                    <input type="hidden" id="update4_delete">
                                    <div class="update-data-main">
                                        <h3>Настройка обновления</h3>
                                        <div class="form-group">
                                            <label for="update4_type">Тип</label>
                                            <select id="update4_type" class="form-control update_type">
                                                <option>Перевод</option>
                                                <option>Глобальная редактура</option>
                                                <option>Обновление иллюстраций</option>
                                                <option>Другое</option>
                                            </select>
                                            <label for="update4_chapter">Глава</label>
                                            <select id="update4_chapter_select" class="form-control update_chapter">
                                            </select>
                                            <label for="update4_date_input">Дата</label>
                                            <div class="form-group">
                                                <input type="text" class="form-control date-input" id="update4_date_input" value="2015-5-1 23-25">
                                            </div>
                                            <label for="update4_name">Описание (опционально)</label>
                                            <input class="form-control" type="text" id="update4_description" placeholder="Перевод">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>


                <form class="admin-block" id="imagesHead">
                    <div class="admin-header">
                        <span>Изображения</span>
                        <div class="btn-group" role="group" aria-label="Панель изображений">
                            <button type="button" class="btn btn-success" title="Добавить новые изображения" id="btn-image-add"><i class="fa fa-plus"></i>
                                <input type="file" class='fileupload' multiple>
                            </button>
                            <button type="button" class="btn btn-default btn-border" title="Режим замены изображений" id="btn-image-replace-main"><i class="fa fa-retweet"></i>
                            </button>
                            <button type="button" class="btn btn-default btn-border" title="Режим добавления/замены покрасов" id="btn-image-reset-color"><i class="fa fa-retweet" style="color: #60a9d4;"></i><i class="fa fa-paint-brush" style="font-size: 9px;margin-left: -9px;"></i>
                            </button>
                            <button type="button" class="btn btn-danger" title="Удалить изображение" id="btn-image-delete" disabled><i class="fa fa-trash-o"></i>
                            </button>
                            <button type="button" class="btn btn-primary" title="Сохранить"><i class="fa fa-floppy-o"></i>
                            </button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-4">
                            <div class="list-group select sortable" id="imageselect">
                                <a class="list-group-item heading" data-chapter-id="-1" value="1"><span class="move">Обложки</span></a>
                                <a class="list-group-item heading" data-chapter-id="1"><span class="move">Начальные иллюстрации</span></a>
                                <a data-toggle="collapse" data-parent="#imageform" href="#image1" aria-expanded="true" aria-controls="image1" class="list-group-item">
                                    <i class="fa fa-ellipsis-v move"></i>
                                    <center><img src="http://ruranobe.ru/w/images/d/d9/AW_v09_02.png">
                                    </center>
                                    <span class="hidden-sm hidden-xs">20.02.2015</span>
                                </a>
                                <a data-toggle="collapse" data-parent="#imageform" href="#image2" aria-expanded="true" aria-controls="image2" class="list-group-item">
                                    <i class="fa fa-ellipsis-v move"></i>
                                    <center><img src="http://ruranobe.ru/w/images/d/d9/AW_v09_02.png">
                                    </center>
                                    <span class="hidden-sm hidden-xs">20.02.2015</span>
                                </a>
                                <a data-toggle="collapse" data-parent="#imageform" href="#image3" aria-expanded="true" aria-controls="image3" class="list-group-item">
                                    <i class="fa fa-ellipsis-v move"></i>
                                    <center><img src="http://ruranobe.ru/w/images/4/45/AW_v09_06.png">
                                    </center>
                                    <span class="hidden-sm hidden-xs">20.02.2015</span>
                                </a>
                                <a data-toggle="collapse" data-parent="#imageform" href="#image4" aria-expanded="true" aria-controls="image4" class="list-group-item">
                                    <i class="fa fa-ellipsis-v move"></i>
                                    <center><img src="http://ruranobe.ru/w/images/d/d7/AW_v09_07.jpg">
                                    </center>
                                    <span class="hidden-sm hidden-xs">20.02.2015</span>
                                </a>
                                <a class="list-group-item heading" data-chapter-id="2"><span class="move">Пролог</span></a>
                                <a class="list-group-item heading" data-chapter-id="3"><span class="move">Глава 1</span></a>
                                <a data-toggle="collapse" data-parent="#imageform" href="#image5" aria-expanded="true" aria-controls="image5" class="list-group-item">
                                    <i class="fa fa-ellipsis-v move"></i>
                                    <center><img src="http://ruranobe.ru/w/images/d/d7/AW_v09_07.jpg">
                                    </center>
                                    <span class="hidden-sm hidden-xs">20.02.2015</span>
                                </a>
                                <a class="list-group-item heading" data-chapter-id="4"><span class="move">Глава 2</span></a>
                            </div>
                        </div>
                        <div class="col-xs-8 admin-affix" id="imageform" role="tablist" aria-multiselectable="true">
                            &nbsp;
                            <div class="progress collapse">
                                <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                    <span class="sr-only">0% Complete</span>
                                </div>
                            </div>
                            <div class="panel">
                                <div class="row collapse image-data" role="tabpanel" id="image1">
                                    <input type="hidden" id="image1_id">
                                    <input type="hidden" id="image1_order">
                                    <input type="hidden" id="image1_chapter_id">
                                    <input type="hidden" id="image1_delete">
                                    <div class="col-xs-6 image-data-main">
                                        <h3>Основа <button type="button" class="btn btn-default btn-image-replace" title="Заменить изображение"><i class="fa fa-retweet"></i><input type="file" class='fileupload'></button></h3>
                                        <center class="btn-image-replace">
                                            <input type="file" class='fileupload'>
                                            <img src="http://ruranobe.ru/w/images/d/d9/AW_v09_02.png" class="img-responsive">
                                        </center>
                                        <div class="form-group">
                                            <label for="image1_main_date">Дата загрузки</label>
                                            <input type="text" class="form-control disable" disabled id="image1_main_date" value="20.02.2015 10:00:00">
                                        </div>
                                        <div class="form-group">
                                            <label for="image1_main_name">Имя файла</label>
                                            <input type="text" class="form-control disable" disabled id="image1_main_name" value="*имя*">
                                        </div>
                                    </div>
                                    <div class="col-xs-6 image-data-color">
                                        <h3>Покрас <button type="button" class="btn btn-default btn-image-replace" title="Добавить изображение"><i class="fa fa-plus"></i><input type="file" class='fileupload'></button></h3>
                                        <center class="btn-image-replace">
                                            <input type="file" class='fileupload'>
                                        </center>
                                        <div class="form-group">
                                            <label for="image1_color_date">Дата загрузки</label>
                                            <input type="text" class="form-control disable" disabled id="image1_color_date" value="20.02.2015 10:00:00">
                                        </div>
                                        <div class="form-group">
                                            <label for="image1_color_name">Имя файла</label>
                                            <input type="text" class="form-control disable" disabled id="image1_color_name" value="*имя*">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel">
                                <div class="row collapse image-data" role="tabpanel" id="image2">
                                    <input type="hidden" id="image2_id">
                                    <input type="hidden" id="image2_order">
                                    <input type="hidden" id="image2_chapter_id">
                                    <input type="hidden" id="image2_delete">
                                    <div class="col-xs-6 image-data-main">
                                        <h3>Основа <button type="button" class="btn btn-default btn-image-replace" title="Заменить изображение"><i class="fa fa-retweet"></i><input type="file" class='fileupload'></button></h3>
                                        <center class="btn-image-replace">
                                            <input type="file" class='fileupload'>
                                            <img src="http://ruranobe.ru/w/images/d/d9/AW_v09_02.png" class="img-responsive">
                                        </center>
                                        <div class="form-group">
                                            <label for="image2_main_date">Дата загрузки</label>
                                            <input type="text" class="form-control disable" disabled id="image2_main_date" value="20.02.2015 10:00:00">
                                        </div>
                                        <div class="form-group">
                                            <label for="image2_main_name">Имя файла</label>
                                            <input type="text" class="form-control disable" disabled id="image2_main_name" value="*имя*">
                                        </div>
                                    </div>
                                    <div class="col-xs-6 image-data-color">
                                        <h3>Покрас <button type="button" class="btn btn-default btn-image-replace" title="Добавить изображение"><i class="fa fa-plus"></i><input type="file" class='fileupload'></button></h3>
                                        <center class="btn-image-replace">
                                            <input type="file" class='fileupload'>
                                        </center>
                                        <div class="form-group">
                                            <label for="image2_color_date">Дата загрузки</label>
                                            <input type="text" class="form-control disable" disabled id="image2_color_date" value="20.02.2015 10:00:00">
                                        </div>
                                        <div class="form-group">
                                            <label for="image2_color_name">Имя файла</label>
                                            <input type="text" class="form-control disable" disabled id="image2_color_name" value="*имя*">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel">
                                <div class="row collapse image-data" role="tabpanel" id="image3">
                                    <input type="hidden" id="image3_id">
                                    <input type="hidden" id="image3_order">
                                    <input type="hidden" id="image3_chapter_id">
                                    <input type="hidden" id="image3_delete">
                                    <div class="col-xs-6 image-data-main">
                                        <h3>Основа <button type="button" class="btn btn-default btn-image-replace" title="Заменить изображение"><i class="fa fa-retweet"></i><input type="file" class='fileupload'></button></h3>
                                        <center class="btn-image-replace">
                                            <input type="file" class='fileupload'>
                                            <img src="http://ruranobe.ru/w/images/4/45/AW_v09_06.png" class="img-responsive">
                                        </center>
                                        <div class="form-group">
                                            <label for="image3_main_date">Дата загрузки</label>
                                            <input type="text" class="form-control disable" disabled id="image3_main_date" value="20.02.2015 10:00:00">
                                        </div>
                                        <div class="form-group">
                                            <label for="image3_main_name">Имя файла</label>
                                            <input type="text" class="form-control disable" disabled id="image3_main_name" value="*имя*">
                                        </div>
                                    </div>
                                    <div class="col-xs-6 image-data-color">
                                        <h3>Покрас <button type="button" class="btn btn-default btn-image-replace" title="Добавить изображение"><i class="fa fa-plus"></i><input type="file" class='fileupload'></button></h3>
                                        <center class="btn-image-replace">
                                            <input type="file" class='fileupload'>
                                        </center>
                                        <div class="form-group">
                                            <label for="image3_color_date">Дата загрузки</label>
                                            <input type="text" class="form-control disable" disabled id="image3_color_date" value="20.02.2015 10:00:00">
                                        </div>
                                        <div class="form-group">
                                            <label for="image3_color_name">Имя файла</label>
                                            <input type="text" class="form-control disable" disabled id="image3_color_name" value="*имя*">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel">
                                <div class="row collapse image-data" role="tabpanel" id="image4">
                                    <input type="hidden" id="image4_id">
                                    <input type="hidden" id="image4_order">
                                    <input type="hidden" id="image4_chapter_id">
                                    <input type="hidden" id="image4_delete">
                                    <div class="col-xs-6 image-data-main">
                                        <h3>Основа <button type="button" class="btn btn-default btn-image-replace" title="Заменить изображение"><i class="fa fa-retweet"></i><input type="file" class='fileupload'></button></h3>
                                        <center class="btn-image-replace">
                                            <input type="file" class='fileupload'>
                                            <img src="http://ruranobe.ru/w/images/d/d7/AW_v09_07.jpg" class="img-responsive">
                                        </center>
                                        <div class="form-group">
                                            <label for="image4_main_date">Дата загрузки</label>
                                            <input type="text" class="form-control disable" disabled id="image4_main_date" value="20.02.2015 10:00:00">
                                        </div>
                                        <div class="form-group">
                                            <label for="image4_main_name">Имя файла</label>
                                            <input type="text" class="form-control disable" disabled id="image4_main_name" value="*имя*">
                                        </div>
                                    </div>
                                    <div class="col-xs-6 image-data-color">
                                        <h3>Покрас <button type="button" class="btn btn-default btn-image-replace" title="Добавить изображение"><i class="fa fa-plus"></i><input type="file" class='fileupload'></button></h3>
                                        <center class="btn-image-replace">
                                            <input type="file" class='fileupload'>
                                        </center>
                                        <div class="form-group">
                                            <label for="image4_color_date">Дата загрузки</label>
                                            <input type="text" class="form-control disable" disabled id="image4_color_date" value="20.02.2015 10:00:00">
                                        </div>
                                        <div class="form-group">
                                            <label for="image4_color_name">Имя файла</label>
                                            <input type="text" class="form-control disable" disabled id="image4_color_name" value="*имя*">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel">
                                <div class="row collapse image-data" role="tabpanel" id="image5">
                                    <input type="hidden" id="image5_id">
                                    <input type="hidden" id="image5_order">
                                    <input type="hidden" id="image5_chapter_id">
                                    <input type="hidden" id="image5_delete">
                                    <div class="col-xs-6 image-data-main">
                                        <h3>Основа <button type="button" class="btn btn-default btn-image-replace" title="Заменить изображение"><i class="fa fa-retweet"></i><input type="file" class='fileupload'></button></h3>
                                        <center class="btn-image-replace">
                                            <input type="file" class='fileupload'>
                                            <img src="http://ruranobe.ru/w/images/d/d7/AW_v09_07.jpg" class="img-responsive">
                                        </center>
                                        <div class="form-group">

                                            <label for="image5_main_date">Дата загрузки</label>
                                            <input type="text" class="form-control disable" disabled id="image5_main_date" value="20.02.2015 10:00:00">
                                        </div>
                                        <div class="form-group">
                                            <label for="image5_main_name">Имя файла</label>
                                            <input type="text" class="form-control disable" disabled id="image5_main_name" value="*имя*">
                                        </div>
                                    </div>
                                    <div class="col-xs-6 image-data-color">
                                        <h3>Покрас <button type="button" class="btn btn-default btn-image-replace" title="Заменить изображение"><i class="fa fa-retweet"></i><input type="file" class='fileupload'></button></h3>
                                        <center class="btn-image-replace">
                                            <input type="file" class='fileupload'>
                                            <img src="http://ruranobe.ru/w/images/d/d7/AW_v09_07.jpg" class="img-responsive">
                                        </center>
                                        <div class="form-group">
                                            <label for="image5_color_date">Дата загрузки</label>
                                            <input type="text" class="form-control disable" disabled id="image5_color_date" value="20.02.2015 10:00:00">
                                        </div>
                                        <div class="form-group">
                                            <label for="image5_color_name">Имя файла</label>
                                            <input type="text" class="form-control disable" disabled id="image5_color_name" value="*имя*">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </main>
        </div>
    </div>

    <script type="text/javascript">
        (function($) {
            $.trimLeft = function(element, options) {
                var trim = this;
                var $element = $(element), // reference to the jQuery version of DOM element
                        element = element; // reference to the actual DOM element
                var initialText = element.innerHTML;
                trim.init = function() {
                    overrideNodeMethod("html", function() {
                        return initialText;
                    });
                    trimContents(element, element);
                    return trim;
                };
                trim.reset = function() {
                    element.innerHTML = initialText;
                    return trim;
                };
                //Overide .html() to return initialText.
                var overrideNodeMethod = function(methodName, action) {
                    var originalVal = $.fn[methodName];
                    var thisNode = $element;
                    $.fn[methodName] = function() {
                        if (this[0] == thisNode[0]) {
                            return action.apply(this, arguments);
                        } else {
                            return originalVal.apply(this, arguments);
                        }
                    };
                };
                var trimContents = function(row, node) {
                    while (row.scrollWidth > row.offsetWidth) {
                        var childNode = node.firstChild;
                        if (!childNode)
                            return true;
                        if (childNode.nodeType == document.TEXT_NODE) {
                            trimText(row, node, childNode);
                        } else {
                            var empty = trimContents(row, childNode);
                            if (empty) {
                                node.removeChild(childNode);
                            }
                        }
                    };
                };
                var trimText = function(row, node, textNode) {
                    var value = '\u2026' + textNode.nodeValue;
                    do {
                        value = '\u2026' + value.substr(4);
                        textNode.nodeValue = value;
                        if (value == '\u2026') {
                            node.removeChild(textNode);
                            return;
                        }
                    }
                    while (row.scrollWidth > row.offsetWidth);
                };
                trim.init();
            };
            $.fn.trimLeft = (function(options) {
                var othat = this;
                var single = function(that) {
                    if (undefined == $(that).data('trim')) {
                        var trim = new $.trimLeft(that, options);
                        $(that).data('trim', trim);
                        $(window).resize(function() {
                            $(that).each(function() {
                                trim.reset().init();
                            });
                        });
                    }
                };
                var multiple = function() {
                    $(othat).each(function() {
                        single(this);
                    });
                };
                if ($(othat).length > 1)
                    multiple(othat);
                else
                    single(othat);
                //-----------
                return this;
            });
        })(jQuery);
    </script>


    <script type="text/javascript">
        /*классы:
         list-group - бутстрапны класс
         select - мой класс для обозначения list-group`ов админки с возможностью выбора
         sortable - мой класс для обозначения тех .list-group.select в которых пользователь может перетягивать елементы
         move - дочерный елемент в елементах sortable - маркер за который разрешается перетягивать
         heading - такие елементы .list-group.select которые не могут быть выбраны, но могут быть перетянуты. по сути используется только для глав в редактировании изображений - в других модулях потребности в них нет
         */
        $('.list-group.select.sortable').sortable({ // включаем jquery-ui sortable
            items: "a:not(:first-child.heading)", // запрещаем передвигать что либо выше первого heading (не может быть картинок вне глав)
            handle:'.move' // задаем маркер перетягивания
        });

        //admin-affix - мой класс для обозначения общего елемента, который аффиксируется справа от списка .list-group.select
        $('.admin-affix').each(function() { // используется bootstrap affix
            var parent = $(this).parent();
            $(this).affix({
                offset: {
                    top: function() { return parent.offset().top - 10; }, // в открепленнойм стиле у меня стоит отступ 10 пикселов от верхнего края экрана, знасит откреплять мы начинаем за 10 пикселей от позиции родительского елемента
                    bottom: function() { return $(document).height() - parent.outerHeight(true) - parent.offset().top; } // нижняя граница, конда плагину нужно снова закрепить admin-affix считается по разнице нижней граници родительского елемента и нижнего края экрана
                } // то есть мы аффиксируем admin-affix в пределах его родительского елемента. предпологается что размер родительского елемента растягивается за счет наполнения list-group.select, но нужно где то явно указать min-height что бы в случае если елементов в list-group.select меньше чем высота самого admin-affix, родительский елемень не схлопнулся при откреплении admin-affix
            });
        });

        $(".date-input").datetimepicker({format:"YYYY-MM-DD HH-mm", locale: 'ru', useCurrent: 'hour'}); // инициализация дейтпикера

        /* ------------------------------------------ PARTISIPANTS START ------------------------------------------ */

        $('#participantselect').on( "sortupdate", function() { // для списка участников перевода задаем обработчик перетягивания
            var p_order = 0; // поставим для каждого участника порядковый номер
            $(this).children().each(function(){ // проверяем каждый элемент
                $($(this).attr('href')+'_order').val(++p_order); // обновляем порядок
            });
        });

        var i=0; // id каждого элемента в пункте участников перевода

        $('#btn-participant-add').click(function(){ // обработка кнопки добавления новых участников
            i++;
            var newParticipant = '<a data-toggle="collapse" data-parent="#participantform" href="#participant' + i + '" aria-expanded="true" aria-controls="participant' + i + '" class="list-group-item" >'+'<i class="fa fa-ellipsis-v move"></i>'+'<span class="hidden-sm hidden-xs"  id="participant' + i + '_name">New</span> - <span class="hidden-sm hidden-xs" id="participant' + i + '_role">Role</span>' + '</a>';
            var newPanel = '<div class="panel">'+
                    '<div class="row collapse participant-data" role="tabpanel" id="participant' + i + '">'+
                    '<input type="hidden" id="participant' + i + '_id">'+
                    '<input type="hidden" id="participant' + i + '_order">'+
                    '<input type="hidden" id="participant' + i + '_delete">'+
                    '<div class="participant-data-main">'+
                    '<h3>Настройка участника</h3>'+
                    '<div class="form-group">'+
                    '<label for="participant' + i + '_name">Участник</label>'+
                    '<div id="participant' + i + '_names_selector">'+
                    '<input class="form-control typeahead name-input" type="text" id="participant' + i + '_name_input" value="New">'+
                    '</div>'+
                    '<label for="participant' + i + '_role">Роль</label>'+
                    '<select class="form-control role-input" id="participant_roles_selector">' +
                    '<option selected>Перевод с английского</option>' +
                    '<option>Эдит</option>' +
                    '<option>Редактура</option>' +
                    '<option>Test</option>' +
                    '</select>'+
                    '<input type="checkbox" id="name_title" name="name_title"><label for="name_title"> Отображать команду</label>'+
                    '</div>'+
                    '</div>'+
                    '</div>'+
                    '</div>';
            $('#participantselect').append(newParticipant);
            $('#participantform').append(newPanel);
            $('#participant' + i + '_names_selector .typeahead').typeahead({  // инициализируем обработчик имен при каждом создании участника
                        hint: true,
                        limit: 10,
                        highlight: true,
                        minLength: 1
                    },
                    {
                        name: 'participant_names',
                        source: substringMatcher(names)
                    });
            $('.typeahead').bind('typeahead:select', function(ev, suggestion) {
                var id = $('.participant-data.in').attr('id');
                $('#' + id + '_name').html(suggestion);
            });
        });

        // ---------- typeahead start ----------
        var substringMatcher = function(strs) {
            return function findMatches(q, cb) {
                var matches, substringRegex;

                // an array that will be populated with substring matches
                matches = [];

                // regex used to determine if a string contains the substring `q`
                substrRegex = new RegExp(q, 'i');

                // iterate through the pool of strings and for any string that
                // contains the substring `q`, add it to the `matches` array
                $.each(strs, function(i, str) {
                    if (substrRegex.test(str)) {
                        matches.push(str);
                    }
                });

                cb(matches);
            };
        };

        var names = ['Ushwood', 'Danholm', 'Lady Astrel', 'Test'
        ];

        var authors = ['Oda Shiichiro', 'Sorachi Hideyaki', 'Lev Tolstoi', 'Test'
        ];

        var illustrators = ['Andrew Rublev', 'Someone Someoneson', 'Hitomi Akira', 'Test'
        ];

        $('#participantform').children('.panel').each(function(){
            i++;
            $('#participant' + i + '_names_selector .typeahead').typeahead({  // обработчик никнеймов
                        hint: true,
                        limit: 10,
                        highlight: true,
                        minLength: 1
                    },
                    {
                        name: 'participant_names',
                        source: substringMatcher(names)
                    });
        });

        $('#author-name-typeahead .typeahead').typeahead({  // обработчик имен авторов
                    hint: true,
                    limit: 10,
                    highlight: true,
                    minLength: 1
                },
                {
                    name: 'author_names',
                    source: substringMatcher(authors)
                });

        $('#illustrator-name-typeahead .typeahead').typeahead({  // обработчик имен иллюстраторов
                    hint: true,
                    limit: 10,
                    highlight: true,
                    minLength: 1
                },
                {
                    name: 'illustrator_names',
                    source: substringMatcher(illustrators)
                });
        // ---------- typeahead end --------------

        $('#participantselect').on('click', 'a.list-group-item', function() { // баг фикс кнопки удаления
            $('.participant-data.in').collapse('hide');
            $($(this).attr('href')).collapse('show');
        });

        $('.typeahead').bind('typeahead:select', function(ev, suggestion) {
            var id = $('.participant-data.in').attr('id');
            $('#' + id + '_name').html(suggestion);
        });

        $('#participantform').on('keyup', '.name-input', function(){
            var elem = $(this);  // засовываем этот объект в переменную (на всякий случай)
            var id = $('.participant-data.in').attr('id'); // получаем id участника
            $('#' + id + '_name').html(elem.val()); // при помощи предыдущего значения вытворяем с именами, что хотим
        });

        $('#participantform').on('change', '.role-input', function(){
            var elem = $(this);  // засовываем этот объект в переменную (на всякий случай)
            var id = $('.participant-data.in').attr('id'); // получаем id участника
            $('#' + id + '_role').html(elem.val()); // при помощи предыдущего значения вытворяем с ролями, что хотим
        });

        $('#participantform').on('hidden.bs.collapse', '.participant-data', function () { // обработка активности кнопки удаления
            $('#btn-participant-delete').attr('disabled',true);
        }).on('shown.bs.collapse', '.participant-data', function() {
            $('#btn-participant-delete').attr('disabled',false);
        });

        $('#btn-participant-delete').on('click',function(){ // обработка кнопки удаления для участников
            var id = $('.participant-data.in').attr('id');
            var nextParticipant = $('#participantselect [href="#'+id+'"]').next();
            var nextPanel = $(nextParticipant.attr('href'));
            $('.participant-data.in').collapse('hide');
            $('#'+id+'_detele').val(true);
            $('#participantselect [href="#'+id+'"]').detach();
            if (nextParticipant.attr('class') && nextPanel.attr('class')) {
                nextParticipant.addClass('active');
                nextPanel.collapse('show');
            } else {
                $('#participantselect').children().last().addClass('active');
                $($('#participantselect').children().last().attr('href')).collapse('show');
            }
        });

        /* ----------------------------------------- PARTISIPANTS END ----------------------------------------- */

        /* ------------------------------------------ CHAPTERS START ------------------------------------------ */

        var OptionsForSelect = '<option>Весь том</option>'; // опции для селекта
        var u=0; // переменная для select'а

        $('#chapterselect').on( "sortupdate", function( event, ui ) { // для списка глав задаем обработчик перетягивания
            var p_order = 0; // поставим для каждой главы порядковый номер
            $(this).children().each(function(){ // проверяем каждый элемент
                $($(this).attr('href')+'_order').val(++p_order); // обновляем порядок
        //              console.log($(this).attr('href')); // на всякий случай пока оставлю
        //              console.log(p_order);
            });
            var id = ui.item.attr('href').substring(8); // находим id главы, которую только что перетащили
            var isRightChapter = false; // переменная поиска
            var chapter = []; // массив для картинок с главой
            chapter.push($('.heading[data-chapter-id='+ id +']').get(0)); // пихаем саму главу в массив
            $('#imageselect').children().each(function(){ // проверим главу на наличие картинок под ней
                if(($(this).is('.heading[data-chapter-id]')) && ($(this).attr('data-chapter-id') == id*1)) { // если это нужный нам heading,
                    isRightChapter = true; // то начинаем искать
                } else if (($(this).attr('data-parent') == '#imageform') && (isRightChapter)) {
                    chapter.push($(this).get(0)); // пихаем последнюю картинку что нашли в массив
                } else {
                    isRightChapter = false; // перестаем искать, как только натыкаемся на другой heading
                }
            });
            if (ui.item.next().attr('href')) { // если следующий элемент в списке присутствует,
                var nextElem = ui.item.next(); // то получаем его
                id = nextElem.attr('href').substring(8); // находим id следующей главы
                $('.heading[data-chapter-id='+ id +']').before(chapter); // и вставляем перед ней
            } else { // иначе
                $('#imageselect').append(chapter); // вставляем в конце селекта
            }
            OptionsForSelect = '<option>Весь том</option>'; // при любом перетаскивании строим селект снова
            u = 0;
            $('#chapterselect').children('a').each(function(){
                u++;
                OptionsForSelect = OptionsForSelect + '<option id="select_chapter' + u + '">' + $(this).children('span').text() + ' (' + u + ')</option>';
            });
            $('#updateform').children('.panel').find('.update_chapter').html(OptionsForSelect);
        });

        var j=0; // id каждого элемента в пункте "Главы"
        var k=0; // нужна, чтобы считать непосредственно сами главы (красивости)

        $('#btn-chapter-add').click(function(){ // обработка кнопки добавления новой главы
            j++;
            var number = 0;
            var chapterTen = false;
            $('#chapterselect').children().each(function(){ // обрабатываем количество "Глав"
                var str1 = $(this).children('span').text();
                if (str1.substring(0,8) == "Глава 10") chapterTen = true;
            });
            $('#chapterselect').children().each(function(){ // обрабатываем количество "Глав"
                var str1 = $(this).children('span').text();
                var str2 = str1.substring(0,5); // вычленяем первые 5 букв
        //              if (str1.substring(0,8) == "Глава 10") chapterTen = true;
                if ((str2 == "Глава") && (str1.substring(6,7)*1 > number) && (!chapterTen)) { // если они совпадают с "главой", и глава меньше 10,
                    number = str1.substring(6,7)*1; // то присваеваем наибольшее число переменной
                }
                if ((str2 == "Глава") && (str1.substring(6,8)*1 > number) && (chapterTen)) { // если они совпадают с "главой", и глава больше 10,
                    number = str1.substring(6,8)*1; // то присваеваем наибольшее число переменной
                }
            });
            k = number;
            k++;
            var newChapter = '<a data-toggle="collapse" data-parent="#chapterform" href="#chapter' + j + '" aria-expanded="true" aria-controls="chapter' + j + '" class="list-group-item" >'+
                    '<i class="fa fa-ellipsis-v move"></i>'+
                    '<span class="hidden-sm hidden-xs"  id="chapter' + j + '_name">Глава ' + k + '</span>'+
                    '</a>';
            var newPanel = '<div class="panel">'+
                    '<div class="row collapse chapter-data" role="tabpanel" id="chapter' + j + '">'+
                    '<input type="hidden" id="chapter' + j + '_id">'+
                    '<input type="hidden" id="chapter' + j + '_order">'+
                    '<input type="hidden" id="chapter' + j + '_delete">'+
                    '<div class="chapter-data-main">'+
                    '<h3>Настройка главы</h3>'+
                    '<div class="form-group checkbox">'+
                    '<label>'+
                    '<input type="checkbox" class="form-control is-subchapter" id="chapter' + j + '_is_subchapter" name="chapter' + j + '_is_subchapter">'+
                    '&emsp;Подглава'+
                    '</label>'+
                    '</div>'+
                    '<div class="form-group">'+
                    '<label for="chapter' + j + '_url">Ссылка</label>'+
                    '<input class="form-control url-input" type="text" id="chapter' + j + '_url_input">'+
                    '<label for="chapter' + j + '_name">Заголовок</label>'+
                    '<input class="form-control name-input" type="text" id="chapter' + j + '_name_input" value="Глава ' + k + '">'+
                    '</div>'+
                    '</div>'+
                    '</div>'+
                    '</div>';
            var newChapterHeading = '<a class="list-group-item heading" data-chapter-id="' + j + '"><span class="move">Глава ' + k + '</span></a>';
            if (!($('#chapterselect').children('.active').attr('href'))) { // если не выбранно ни одного элемента
                $('#chapterselect').append(newChapter);
                $('#chapterform').append(newPanel);
                $('#imageselect').append(newChapterHeading); // то вставляем новые главы, панели для глав, heading'и в конец
            } else {                                         // иначе
                $('#chapterselect').children('.active').after(newChapter);
                $('#chapterform').children('.panel').each(function(){
                    if ($(this).children().hasClass('in')) $(this).after(newPanel); // вставляем после выбранного элемента
                });
                var isRightChapter = false; // переменная поиска
                var imageAfterChapter; // переменная для картинки
                var id = $('.chapter-data.in').attr('id'); // id выбранного элемента
                id = id.substring(7); // берем оттуда только цифру
                $('#imageselect').children().each(function(){ // в случае с heading мы будеми проверять его на наличие картинок под ним
                    if(($(this).is('.heading[data-chapter-id]')) && ($(this).attr('data-chapter-id') == id*1)) {
                        isRightChapter = true; // если это нужный нам heading, то начинаем искать
                    } else if (($(this).attr('data-parent') == '#imageform') && (isRightChapter)) {
                        imageAfterChapter = $(this); // пихаем последнюю картинку что нашли в переменную
                    } else {
                        isRightChapter = false; // перестаем искать, как только натыкаемся на другой heading
                    }
                });
                if (imageAfterChapter) { // если мы отыскали какую-либо картинку под выбранной главой
                    imageAfterChapter.after(newChapterHeading); // то вставляем после нее
                } else {
                    $('.heading[data-chapter-id="' + id + '"]').after(newChapterHeading); // иначе втавляем после выбранного heading
                }
            }
            $('#chapter' + j + '_name').css({'margin': '0px 0px 0px 3px'}); // отступ для вновь созданого элемента, дабы он выглядел как все
            var p_order = 0; // поставим для каждой главы порядковый номер
            $(this).children().each(function(){ // проверяем каждый элемент
                $($(this).attr('href')+'_order').val(++p_order); // обновляем порядок
                console.log($(this).attr('href')); // на всякий случай пока оставлю
                console.log(p_order);
            });
            OptionsForSelect = '<option>Весь том</option>'; // Начинаем строить селект
            u = 0;
            $('#chapterselect').children('a').each(function(){
                u++;
                OptionsForSelect = OptionsForSelect + '<option id="select_chapter' + u + '">' + $(this).children('span').text() + ' (' + u + ')</option>';
            });
            $('#updateform').children('.panel').find('.update_chapter').html(OptionsForSelect);
        });

        $('#chapterform').children('.panel').each(function(){
            j++; // считаем кажую панель
        });

        $('#chapterform').on('keyup', '.name-input', function(){
            var elem = $(this);  // засовываем этот объект в переменную (на всякий случай)
            var id = $('.chapter-data.in').attr('id'); // получаем id главы
            $('#' + id + '_name').html(elem.val()); // при помощи предыдущего значения вытворяем с именами, что хотим
            id = id.substring(7);
            $('.heading[data-chapter-id="' + id + '"]').children().html(elem.val());
            $('#select_chapter' + id).html(elem.val());
        //      console.log($('#select_chapter' + id));
        });

        $('#chapterform').on('click', '.is-subchapter', function(){ // обработчик подглав
            var id = $('.chapter-data.in').attr('id'); // получаем id главы
            if ($(this).prop("checked")) { // если выделено, то
                $('#' + id + '_name').css({'margin': '0px 0px 0px 28px'}); // при помощи css делаем подглаву
            } else {
                $('#' + id + '_name').css({'margin': '0px 0px 0px 3px'}); // либо делаем наоборот
            }
        })

        $('#chapterselect').on('click', 'a.list-group-item', function() { // баг фикс кнопки удаления (line 1185)
            $('.chapter-data.in').collapse('hide');
            $($(this).attr('href')).collapse('show');
        });

        $('#chapterform').on('hidden.bs.collapse', '.chapter-data', function () { // обработка активности кнопки удаления
            $('#btn-chapter-delete').attr('disabled',true);
        }).on('shown.bs.collapse', '.chapter-data', function() {
            $('#btn-chapter-delete').attr('disabled',false);
        });

        $('#btn-chapter-delete').on('click',function(){ // обработка кнопки удаления для глав
            var id = $('.chapter-data.in').attr('id');
            var nextChapter = $('#chapterselect [href="#'+id+'"]').next();
            var nextPanel = $(nextChapter.attr('href'));
            $('.chapter-data.in').collapse('hide');
            $('#'+id+'_detele').val(true);
            $('#chapterselect [href="#'+id+'"]').detach();
            id = id.substring(7);
            $('.heading[data-chapter-id="'+id+'"]').detach();
            if (nextChapter.attr('class') && nextPanel.attr('class')) {
                nextChapter.addClass('active');
                nextPanel.collapse('toggle');
            } else {
                $('#chapterselect').children().last().addClass('active');
                $($('#chapterselect').children().last().attr('href')).collapse('toggle');
            }
        });

        /* ------------------------------------------ CHAPTERS END ------------------------------------------ */

        /* ------------------------------------------ UPDATES START ----------------------------------------- */

        $('#updateselect').on( "sortupdate", function() { // для списка обновлений задаем обработчик перетягивания
            var up_order = 0; // поставим для каждого обновления порядковый номер
            $(this).children().each(function(){ // проверяем каждый элемент
                $($(this).attr('href')+'_order').val(++up_order); // обновляем порядок
            });
        });

        var v=0; // id каждого элемента в пункте "Обновления"

        $('#chapterselect').children('a').each(function(){
            u++;
            OptionsForSelect = OptionsForSelect + '<option id="select_chapter' + u + '">' + $(this).children('span').text() + ' (' + u + ')</option>';
        });

        $('#btn-update-add').click(function(){ // обработка кнопки добавления нового обновления
            v++;
            var nowDate = new Date();
            var nowMonth = ('0'+(nowDate.getMonth()+1)).slice(-2);
            var nowDay = ('0'+nowDate.getDate()).slice(-2);
            var nowHours = ('0'+nowDate.getHours()).slice(-2);
            var nowMinutes = ('0'+nowDate.getMinutes()).slice(-2);
            var today = nowDate.getFullYear() + '-' + nowMonth + '-' + nowDay + ' ' + nowHours + '-' + nowMinutes;
            var newUpdate = '<a data-toggle="collapse" data-parent="#updateform" href="#update' + v + '" aria-expanded="true" aria-controls="update' + v + '" class="list-group-item" >'+
                    '<span class="hidden-sm hidden-xs"  id="update' + v + '_date">' + today + '</span>:'+
                    '<span class="hidden-sm hidden-xs"  id="update' + v + '_chapter">Весь том</span>'+
                    '</a>';
            var newPanel = '<div class="panel">'+
                    '<div class="row collapse update-data" role="tabpanel" id="update' + v + '">'+
                    '<input type="hidden" id="update' + v + '_id">'+
                    '<input type="hidden" id="update' + v + '_order">'+
                    '<input type="hidden" id="update' + v + '_delete">'+
                    '<div class="update-data-main">'+
                    '<h3>Настройка обновления</h3>'+
                    '<div class="form-group">'+
                    '<label for="update' + v + '_type">Тип</label>'+
                    '<select id="update' + v + '_type" class="form-control update_type">'+
                    '<option>Перевод</option>'+
                    '<option>Глобальная редактура</option>'+
                    '<option>Обновление иллюстраций</option>'+
                    '<option>Другое</option>'+
                    '</select>'+
                    '<label for="update' + v + '_chapter">Глава</label>'+
                    '<select id="update' + v + '_chapter_select" class="form-control update_chapter">'+
                    '</select>'+
                    '<label for="update' + v + '_date_input">Дата</label>'+
                    '<input class="form-control date-input" type="text" id="update' + v + '_date_input" value="' + today + '">'+
                    '<label for="update' + v + '_name">Описание (опционально)</label>'+
                    '<input class="form-control" type="text" id="update' + v + '_description" placeholder="Перевод">'+
                    '</div>'+
                    '</div>'+
                    '</div>'+
                    '</div>';
            $('#updateselect').prepend(newUpdate);
            $('.update-insert').after(newPanel);
            $('#update' + v + '_chapter_select').append(OptionsForSelect);
            $('#update' + v + '_date_input').datetimepicker({format:"YYYY-MM-DD HH-mm", locale: 'ru', useCurrent: 'hour'});
        });

        $('#updateform').children('.panel').each(function(){
            v++; // считаем кажую панель (читай кажый объект)
            $(this).find('.update_chapter').append(OptionsForSelect);
        });

        $('#updateform').on('dp.change', '.date-input', function(){
            var elem = $(this);  // засовываем этот объект в переменную (на всякий случай)
            var id = $('.update-data.in').attr('id'); // получаем id главы
            $('#' + id + '_date').html(elem.val()); // при помощи предыдущего значения вытворяем с именами, что хотим
        });

        $('#updateform').on('change', '.update_type', function(){
            var elem = $(this);  // засовываем этот объект в переменную (на всякий случай)
            var id = $('.update-data.in').attr('id'); // получаем id главы
            $('#' + id + '_description').prop('placeholder', elem.val()); // при помощи предыдущего значения вытворяем с именами, что хотим
        });

        $('#updateform').on('change', '.update_chapter', function(){
            var elem = $(this);  // засовываем этот объект в переменную (на всякий случай)
            var id = $('.update-data.in').attr('id'); // получаем id главы
            $('#' + id + '_chapter').text(elem.val()); // при помощи предыдущего значения вытворяем с именами, что хотим
        });

        $('#updateselect').on('click', 'a.list-group-item', function() { // баг фикс кнопки удаления
            $('.update-data.in').collapse('hide');
            $($(this).attr('href')).collapse('show');
        });

        $('#updateform').on('hidden.bs.collapse', '.update-data', function () { // обработка активности кнопки удаления
            $('#btn-update-delete').attr('disabled',true);
        }).on('shown.bs.collapse', '.update-data', function() {
            $('#btn-update-delete').attr('disabled',false);
        });

        $('#btn-update-delete').on('click',function(){ // обработка кнопки удаления для глав
            var id = $('.update-data.in').attr('id');
            var nextUpdate = $('#updateselect [href="#'+id+'"]').next();
            var nextPanel = $(nextUpdate.attr('href'));
            $('.update-data.in').collapse('hide');
            $('#'+id+'_detele').val(true);
            $('#updateselect [href="#'+id+'"]').detach();
            if (nextUpdate.attr('class') && nextPanel.attr('class')) {
                nextUpdate.addClass('active');
                nextPanel.collapse('show');
            } else {
                $('#updateselect').children().last().addClass('active');
                $($('#updateselect').children().last().attr('href')).collapse('show');
            }
        });

        /* ------------------------------------------ UPDATES END ------------------------------------------- */

        /* ------------------------------------------ IMAGES START ------------------------------------------ */

        var img = $('#imageselect a[href^="#image"]').length+1;
        $('#imageselect').on( "sortupdate", function( event, ui ) { // для списка изображений задаем обработчик перетягивания
            if(ui.item.hasClass('heading')) // если мы перетянули главу, мы должны убедится что не нарушили порядок следовани глав
            {
                var start = 0; // jquery-ui sortable не дает информации о том какой у елемента был индекс до перетягивания
                $(this).children().each(function(i,e) { // поэтому мы находим его линейно
                    if($(e).position().top <= ui.originalPosition.top) // сравнивая по y координате каждого елемента в пикселах с координатой изначального положения
                        start = i;
                    else return false;
                });
                var end = ui.item.index()  // индекс итоговой позиции известен
                if(start < end) // если мы перетянули вниз
                    $(this).children().slice(start, end).filter('.heading').insertAfter(ui.item); // то перемещаем все заголовки (если они есть) между индексами и ставим их в том же порядке после тепущего
                else
                    $(this).children().slice(end + 1, start + 1).filter('.heading').insertBefore(ui.item);  // в противном случае точно так же ставим перед текущим
            }
            var order = 0, chapter_id = 0; // теперь нам нужно для каждого изображения поставить его порядковый номер и id главы к которой оно принадлежит
            $(this).children().each(function(){ // вообще делать это линейно для всех елементов при любом изменении не очень хорошо. правельные было бы обновлять только для тех изображений для которых что-то изменилось. но мне было лень
                if($(this).is('.heading[data-chapter-id]'))
                    chapter_id = $(this).attr('data-chapter-id'); // если мы попали на елемент заголовка - запомнили номер текущей главы
                else {
                    $($(this).attr('href')+'_order').val(++order); // посчитали порядок
                    $($(this).attr('href')+'_chapter_id').val(chapter_id); // вспомнили последний известный айдишник главы
                }
            });
        });

        $('#imageselect').on('click', 'a.list-group-item', function() { // баг фикс кнопки удаления
            $('.image-data.in').collapse('hide');
            $($(this).attr('href')).collapse('show');
        });

        // дальше пошел код спецефический для изображений. его я буду комментировать не так подробно


        // активируем и деактивируем кнопку удаления иллюстраций в зависимости от того выбрано что то или нет
        $('.image-data').on('hidden.bs.collapse', function () {
            $('#btn-image-delete').attr('disabled',true);
        }).on('shown.bs.collapse', function() {
            $('#btn-image-delete').attr('disabled',false);
        });

        // рисуем дропзоны при затягивании файла на страницу браузера
        $(document).on('dragover', function(e) {
            if (window.dropZoneTimeout)
                clearTimeout(window.dropZoneTimeout);
            else $('body').addClass('dragover'); //выставляем класс на body который активирует css отрисовку дропзон

            // при затягивании файла в одну из дропзон, она подсвечивается
            $('.image-data-main,.image-data-color,#imageselect').removeClass('hover');
            $(e.target).closest('.image-data-main,.image-data-color,#imageselect').addClass('hover');

            // если в течении 400мс событие не повторяется предпологаем что никто уже ничего не перетягивает и выключаем отрисовку дропзон
            window.dropZoneTimeout = setTimeout(function() {
                window.dropZoneTimeout = null;
                $('body').removeClass('dragover');
                $('.image-data-main,.image-data-color,#imageselect').removeClass('hover');
            }, 400);
        }).on('drop dragover dragstart', function(e) { e.preventDefault(); }); // выключаем стандортное поведение браузера на drag'n'drop

        // настраиваем jQuery File Upload для кнопки заменить или затягивания файла на существующую ирасту
        function replaceImage(){
            $('.btn-image-replace').each(function(){
                var $this = $(this);
                $(this).fileupload({
                    url: "/rura/loading_files.php",
                    dataType: 'json',
                    formData: {
                        ctype: $this.closest('.image-data-main').length ? 'main' : 'color',
                        num: $this.closest('.image-data').attr('id').substr(5),
                        id: $('#'+$this.closest('.image-data').attr('id')+'_id').val()
                    },
                    acceptFileTypes: /(\.|\/)(jpe?g|png|jpg)$/i,
                    previewMaxHeight: 180,
                    previewMaxWidth: 260,
                    maxNumberOfFiles: 1,
                    dropZone: $this.closest('.image-data-main,.image-data-color')
                }).on('fileuploadadd', function (e, data) {
                    data.files[0].num = $this.closest('.image-data').attr('id').substr(5);
                    data.files[0].ctype = $this.closest('.image-data-main').length ? 'main' : 'color';
                    $this.closest('.image-data-main,.image-data-color').find('img').after('<center class="btn-image-replace"><i class="fa fa-spinner fa-spin"></i></center>').detach();
                    $('#imageform .progress').collapse('show');
                    data.submit();
                })
            });

            $('#btn-image-add,.btn-image-replace').on('fileuploadprocessalways', function (e, data) {
                console.log(data);
                var index = data.index,
                        file = data.files[index];
                if (file.preview) { // заменяем иконку загрузки за превюшку, как только она становится доступна
                    $('#imageselect a[href="#image'+file.num+'"] center').empty().append(file.preview);
                    var newCanvas = $(file.preview).clone().get(0);
                    newCanvas.getContext('2d').drawImage(file.preview, 0, 0);
                    $('#image'+file.num+' .image-data-'+file.ctype+' center').empty().append(newCanvas);
                }
                if (file.error) // или выводим сообщение об ошибке обработки на клиенте
                    $('#imageform .progress').after('<div class="alert alert-danger alert-dismissible fade in" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Ошибка!</strong> '+file.error+'</div>');
            }).on('fileuploadprogressall', function (e, data) { // обновляем прогресбар
                var progress = parseInt(data.loaded / data.total * 100, 10);
                $('#imageform .progress-bar').css('width', progress + '%');
                $('#imageform .progress-bar').attr('aria-valuenow', progress);
                $('#imageform .progress-bar span').text(progress + '% Complete');
            }).on('fileuploaddone', function (e, data) { // при завершении загрузки заменяем превюшку на img тег с адресом уже загруженной ирасты
                $('#imageform .progress').collapse('hide');
                console.log(data) // с сервера в json`е должны прийти поля url и id
                var $button = $(this);
                $.each(data.result.files, function (index, file) {
                    if (file.url) {
                        $button.closest('.image-data-main,.image-data-color').find('input:eq(1)').val(moment(data._time).format('DD.MM.YYYY HH:mm:ss'));
                        $button.closest('.image-data-main,.image-data-color').find('input:eq(2)').val(file.name);
                        $button.closest('.image-data-main,.image-data-color').find('center').empty().append($('<img>').attr('src', file.url).addClass('img-responsive'));
                        $('#image'+data.files[index].num).find('.image-data-'+data.files[index].ctype).find('center').empty().append($('<img>').attr('src', file.url).addClass('img-responsive')).append($('<input type="file" class="fileupload">'));
                        $('#image'+data.files[index].num+'_id').val(file.id);
                        $('#imageselect a[href="#image'+data.files[index].num+'"] center').empty().append($('<img>').attr('src', file.url));
                    } else if (file.error) // выводим ошибку возвращенную с сервера
                        $('#imageform .progress').after('<div class="alert alert-danger alert-dismissible fade in" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Ошибка!</strong> '+file.error+'</div>');
                });
            }).on('fileuploadfail', function (e, data) { // выводим ошибку аякса
                $('#imageform .progress').after('<div class="alert alert-danger alert-dismissible fade in" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Ошибка!</strong> Загрузка не удалась</div>');
            });
        }
        replaceImage();

        // настраиваем jQuery File Upload для кнопки добавить или затягивания файла на список иллюстраций
        $('#btn-image-add').fileupload({
            url: "/rura/loading_files.php", // "обработка" загруженых велась у меня на локально денвере. скорее всего без этого вообще работать не будет
            dataType: 'json',
            formData: {ctype: 'main'},
            acceptFileTypes: /(\.|\/)(jpe?g|png|jpg)$/i,
            previewMaxHeight: 180,
            previewMaxWidth: 260,
            dropZone: $('#imageselect')
        }).on('fileuploadadd', function (e, data) { // при добавлении файла сразу создаем елемент в #imageselect
            $.each(data.files, function (index, file) {
                if(!data.last_num) data.last_num = $('#imageselect a[href^="#image"]').length;
                if(!data.last_num) data.last_num = 0;
                img++;
                file.num = ++data.last_num; // num - внутренний/временный айдишник иллюстраций фронтенда - порядок добавления
                file.ctype = 'main'; // ctype - color type. основная ираста или покрас
                $('<a data-toggle="collapse" data-parent="#imageform" href="#image'+file.num+'" aria-expanded="true" aria-controls="image'+file.num+'" class="list-group-item"> <i class="fa fa-ellipsis-v move ui-sortable-handle"></i> <center><i class="fa fa-spinner fa-spin"></i></center> <span class="hidden-sm hidden-xs">'+file.name+'</span> </a>').appendTo('#imageselect');
                $('<div class="panel"><div class="row collapse image-data" role="tabpanel" id="image'+file.num+'"><input type="hidden" id="image'+file.num+'_id"><input type="hidden" id="image'+file.num+'_order"><input type="hidden" id="image'+file.num+'_chapter_id"><input type="hidden" id="image'+file.num+'_delete"><div class="col-xs-6 image-data-main"><h3>Основа <button type="button" class="btn btn-default btn-image-replace" title="Заменить изображение"><i class="fa fa-retweet"></i><input type="file" class="fileupload"></button></h3><center class="btn-image-replace"><input type="file" class="fileupload"><i class="fa fa-spinner fa-spin"></i></center><div class="form-group"><label for="image'+file.num+'_main_date">Дата загрузки</label><input type="text" class="form-control disable" disabled id="image'+file.num+'_main_date" value="'+moment(data._time).format('DD.MM.YYYY HH:mm:ss')+'"></div><div class="form-group"><label for="image'+file.num+'_main_name">Имя файла</label><input type="text" class="form-control disable" disabled id="image'+file.num+'_main_name" value="'+file.name+'"></div></div><div class="col-xs-6 image-data-color"><h3>Покрас <button type="button" class="btn btn-default btn-image-replace" title="Добавить изображение"><i class="fa fa-plus"></i><input type="file" class="fileupload"></button></h3><center class="btn-image-replace"><input type="file" class="fileupload"></center><div class="form-group"><label for="image'+file.num+'_color_date">Дата загрузки</label><input type="text" class="form-control disable" disabled id="image'+file.num+'_color_date" value=""></div><div class="form-group"><label for="image'+file.num+'_color_name">Имя файла</label><input type="text" class="form-control disable" disabled id="image'+file.num+'_color_name" value=""></div></div></div></div>').appendTo('#imageform');
            });
            $('#imageform .progress').collapse('show'); // показываем прогресбар
            data.submit(); // начинаем загрузку
            replaceImage();
        });



        $('#btn-image-delete').click(function(){ // обработка кнопки удаления
            var id = $('.image-data.in').attr('id');
            var nextImage = $('#chapterselect [href="#'+id+'"]').next();
            var nextPanel = $(nextImage.attr('href'));
            $('.image-data.in').collapse('hide');
            $('#'+id+'_detele').val(true);
            $('#imageselect [href="#'+id+'"]').detach();
            if (nextImage.attr('class') && nextPanel.attr('class')) {
                nextImage.addClass('active');
                nextPanel.collapse('show');
            } else {
                $('#chapterselect').children().last().addClass('active');
                $($('#chapterselect').children().last().attr('href')).collapse('show');
            }
        });

        /* ------------------------------------------ IMAGES END ------------------------------------------ */
    </script>
</wicket:extend>
</body>

</html>